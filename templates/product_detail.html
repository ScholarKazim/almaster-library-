{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12 col-md-6 mb-4">
        <!-- Main Product Gallery -->
        <div class="product-gallery bg-white rounded-5 shadow-lg overflow-hidden p-2 border">
            <!-- Main Featured Image -->
            <div class="ratio ratio-1x1 mb-3 rounded-4 overflow-hidden">
                <img id="mainImg" src="{{ product.image_url }}" class="object-fit-cover w-100"
                    alt="{{ product.title }}">
            </div>

            <!-- Horizontal Thumbnails (Scrollable) -->
            <div class="d-flex gap-2 overflow-auto pb-2 px-1 scroll-hide mb-2" id="thumbContainer">
                <!-- We will repeat thumbnails for demonstration -->
                <div class="thumb-wrapper rounded-3 overflow-hidden border-2 border flex-shrink-0"
                    style="width: 70px; height: 70px; cursor: pointer;">
                    <img src="{{ product.image_url }}" class="w-100 h-100 object-fit-cover"
                        onclick="changeImg(this.src, this)">
                </div>
                <!-- Mock images for variety (Normally the admin would upload these) -->
                <div class="thumb-wrapper rounded-3 overflow-hidden border flex-shrink-0"
                    style="width: 70px; height: 70px; cursor: pointer;">
                    <img src="https://images.unsplash.com/photo-1544717297-fa95b3ee21f3?q=80&w=200"
                        class="w-100 h-100 object-fit-cover" onclick="changeImg(this.src, this)">
                </div>
                <div class="thumb-wrapper rounded-3 overflow-hidden border flex-shrink-0"
                    style="width: 70px; height: 70px; cursor: pointer;">
                    <img src="https://images.unsplash.com/photo-1541178735423-479693dbba0e?q=80&w=200"
                        class="w-100 h-100 object-fit-cover" onclick="changeImg(this.src, this)">
                </div>
                <!-- Repeat to show scrolling -->
                {% for i in range(20) %}
                <div class="thumb-wrapper rounded-3 overflow-hidden border flex-shrink-0"
                    style="width: 70px; height: 70px; cursor: pointer;">
                    <img src="https://via.placeholder.com/200?text=Design+{{ i+1 }}"
                        class="w-100 h-100 object-fit-cover" onclick="changeImg(this.src, this)">
                </div>
                {% endfor %}
            </div>
            <p class="text-center small text-muted mb-2">اسحب لليمين واليسار لرؤية جميع الديزاينات المتاحة</p>
        </div>
    </div>

    <div class="col-12 col-md-6">
        <div class="ps-md-4 mt-3 mt-md-0">
            <span class="badge bg-grad-gold px-3 py-1 rounded-pill mb-3">متوفر الآن</span>
            <h1 class="display-6 fw-bold mb-2 text-dark">{{ product.title }}</h1>
            <p class="fs-4 text-primary fw-bold mb-4">{{ "{:,.0f}".format(product.price) }} د.ع</p>

            <div class="bg-white p-4 rounded-4 shadow-sm mb-4 border-start border-5 border-primary">
                <h5 class="fw-bold mb-3 text-primary">طريقة الطلب</h5>
                <p class="text-secondary lh-lg mb-0 small">
                    لطلب الديزاين المختار: <br>
                    1. تصفح الصور واختر رقم الديزاين. <br>
                    2. ادخل رقم الديزاين والاسم المطلوب في الحقل أدناه. <br>
                    3. للإضافات الخاصة، استخدم زر التليكرام.
                </p>
            </div>

            <!-- Customization Section -->
            <div class="bg-light p-4 rounded-4 mb-5 shadow-inner">
                <h6 class="fw-bold mb-4 text-dark"><span class="me-2">✏️</span>مواصفات الطلب</h6>

                <div class="mb-4">
                    <label class="form-label small fw-bold mb-2">رقم الديزاين والاسم</label>
                    <textarea id="customNote" class="form-control form-control-grad" rows="3"
                        placeholder="مثال: ديزاين رقم 5 - اسم علي"></textarea>
                </div>

                <div class="mb-4 text-center">
                    <p class="small text-muted mb-3">لتصميم خاص أو كميات كبيرة:</p>
                    <a href="https://t.me/ALMASTER1" class="btn btn-outline-primary w-100 py-3 rounded-4">
                        <span class="me-2">✈️</span> اطلب ديزاين خاص عبر تليكرام
                    </a>
                </div>
            </div>

            <div class="d-grid gap-3 mb-5">
                <button onclick="addToCart({{ product.id }})"
                    class="btn btn-grad-blue btn-lg py-3 rounded-pill fw-bold shadow-lg">إضافة للحقيبة</button>
            </div>
        </div>
    </div>
</div>

<style>
    .scroll-hide::-webkit-scrollbar {
        display: none;
    }

    .scroll-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .thumb-wrapper.active {
        border-color: var(--primary-color) !important;
        border-width: 3px !important;
    }

    .shadow-inner {
        box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
    }

    .product-gallery {
        position: sticky;
        top: 100px;
    }
</style>

<script>
    function changeImg(src, el) {
        document.getElementById('mainImg').src = src;
        document.querySelectorAll('.thumb-wrapper').forEach(w => w.classList.remove('active'));
        el.parentElement.classList.add('active');
    }

    function addToCart(productId) {
        const note = document.getElementById('customNote').value;
        if (!note) {
            alert('يرجى إدخال رقم الديزاين والاسم المطلوب');
            return;
        }

        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        cart.push({
            id: productId,
            note: note
        });
        localStorage.setItem('cart', JSON.stringify(cart));

        const btn = event.target;
        btn.innerText = 'تمت الإضافة ✓';
        btn.classList.replace('btn-grad-blue', 'btn-success');

        setTimeout(() => {
            btn.innerText = 'إضافة للحقيبة';
            btn.classList.replace('btn-success', 'btn-grad-blue');
        }, 2000);
    }
</script>
{% endblock %}