{% extends "base.html" %}

{% block content %}
<div class="mb-5 text-center">
    <div class="bg-white d-inline-block p-4 rounded-circle shadow-sm mb-3 border">
        <span class="fs-1">ğŸ“¦</span>
    </div>
    <h1 class="display-5 fw-bold mb-2">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
    <p class="text-secondary">Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØªØ¬Ù‡ÙŠØ² Ø·Ù„Ø¨Ø§Øª Ø¯ÙØ¹Ø© Ø§Ù„ØªØ®Ø±Ø¬ 2026</p>
</div>

<div class="row">
    <div class="col-12">
        {% if orders %}
        {% for order in orders %}
        <div
            class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden border-start border-5 {% if order.status == 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' %}border-warning{% elif order.status == 'ØªÙ… Ø§Ù„Ø´Ø­Ù†' %}border-primary{% else %}border-success{% endif %}">
            <div class="card-body p-4">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <span
                            class="badge {% if order.status == 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' %}bg-warning{% elif order.status == 'ØªÙ… Ø§Ù„Ø´Ø­Ù†' %}bg-primary{% else %}bg-success{% endif %} mb-2">
                            {{ order.status }}
                        </span>
                        <h5 class="fw-bold mb-1">Ø·Ù„Ø¨ #{{ order.id }}</h5>
                        <p class="small text-muted mb-0">Ø¨ÙˆØ§Ø³Ø·Ø©: {{ order.full_name }} ({{ order.user.username }})</p>
                        <p class="small text-muted mb-0">Ø§Ù„ØªØ§Ø±ÙŠØ®: {{ order.created_at.strftime('%Y/%m/%d - %H:%M') }}
                        </p>
                    </div>
                    <div class="col-md-4 text-center my-3 my-md-0">
                        <div class="bg-light p-2 rounded-3 small">
                            <p class="mb-1"><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> {{ order.phone }}</p>
                            <p class="mb-0 text-truncate"><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> {{ order.province }} - {{
                                order.address }}</p>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <h4 class="fw-bold text-primary mb-3">{{ "{:,.0f}".format(order.total_price) }} Ø¯.Ø¹</h4>

                        <form action="{{ url_for('update_order_status', id=order.id) }}" method="POST"
                            class="d-flex gap-2 justify-content-md-end align-items-center mb-3">
                            <select name="status" class="form-select form-select-sm rounded-pill shadow-sm w-auto"
                                onchange="this.form.submit()">
                                <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±" {% if order.status=='Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' %}selected{% endif %}>
                                    Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± â³</option>
                                <option value="ØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²" {% if order.status=='ØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²' %}selected{% endif %}>ØªÙ…
                                    Ø§Ù„ØªØ¬Ù‡ÙŠØ² âœ…</option>
                                <option value="ØªÙ… Ø§Ù„Ø´Ø­Ù†" {% if order.status=='ØªÙ… Ø§Ù„Ø´Ø­Ù†' %}selected{% endif %}>ØªÙ… Ø§Ù„Ø´Ø­Ù†
                                    ğŸšš</option>
                                <option value="ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„" {% if order.status=='ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„' %}selected{% endif %}>ØªÙ…
                                    Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸ‰</option>
                            </select>
                        </form>

                        {% set wa_msg = "Ù…Ø±Ø­Ø¨Ø§Ù‹ " ~ order.full_name ~ "ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨ÙƒÙ… Ù…Ù† Ø§Ù„Ù…Ø§Ø³ØªØ±. Ø·Ù„Ø¨ÙƒÙ… Ø±Ù‚Ù… #" ~
                        order.id ~ " " ~ order.status %}
                        <a href="https://wa.me/{{ order.phone.replace('07', '9647') }}?text={{ wa_msg|urlencode }}"
                            target="_blank" class="btn btn-sm btn-success rounded-pill px-3 shadow-sm">
                            <span class="me-1">ğŸ’¬</span> Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø²Ø¨ÙˆÙ†
                        </a>
                    </div>
                </div>

                <hr class="my-3 opacity-10">

                <div class="row">
                    {% for item in order.items %}
                    <div class="col-12 col-md-6 mb-2">
                        <div class="d-flex align-items-center bg-white p-2 rounded-3 border">
                            <img src="{{ item.product.image_url }}" class="rounded-2 me-3"
                                style="width: 50px; height: 50px; object-fit: cover;">
                            <div>
                                <h6 class="small fw-bold mb-0 text-truncate" style="max-width: 200px;">{{
                                    item.product.title }}</h6>
                                {% if item.custom_name %}
                                <p class="mb-0 text-danger" style="font-size: 0.75rem;"><strong>Ø§Ù„ÙˆØµÙ:</strong> {{
                                    item.custom_name }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="text-center py-5 bg-white rounded-5 shadow-sm">
            <div class="fs-1 opacity-25 mb-3">ğŸ“­</div>
            <p class="text-secondary">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ø±Ø¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}